runtime: python39
entrypoint: gunicorn -w 4 -k uvicorn.workers.UvicornWorker main:app

build_env_variables:
  GOOGLE_RUNTIME_VERSION: "3.9"
  PIP_REQUIREMENTS_FILE: "requirements.txt"

# Add explicit scaling configuration
automatic_scaling:
  max_instances: 20
  min_instances: 1
  target_cpu_utilization: 0.65
  max_concurrent_requests: 50

env_variables:
  GOOGLE_CLIENT_ID: "${GOOGLE_CLIENT_ID}"
  GOOGLE_CLIENT_SECRET: "${GOOGLE_CLIENT_SECRET}"
  GOOGLE_REDIRECT_URI: "https://${GOOGLE_CLOUD_PROJECT}.uc.r.appspot.com/api/auth/callback"
  FIRESTORE_PROJECT_ID: "${GOOGLE_CLOUD_PROJECT}"
  SESSION_SECRET_KEY: "${SESSION_SECRET_KEY}"
  GOOGLE_CLOUD_PROJECT: "${GOOGLE_CLOUD_PROJECT}"
  
  # AI/ML Settings
  VERTEX_RAG_MODEL: "gemini-1.0-pro"
  TEXT_EMBEDDING_MODEL: "textembedding-gecko@latest"
  
  # Storage settings
  GCS_BUCKET_NAME: "${GOOGLE_CLOUD_PROJECT}-uploads"
  FRONTEND_URL: "https://frontend-dot-${GOOGLE_CLOUD_PROJECT}.uc.r.appspot.com"

  # Google Cloud Storage settings
  USE_GCS: "true"
  GCS_FOLDER_PREFIX: "uploads"
  GCS_MAKE_PUBLIC: "false"
  GCS_URL_EXPIRATION: "3600"

  # Cloud Tasks settings for vector processing backend
  USE_CLOUD_TASKS: "true"
  GCP_PROJECT_ID: "${GOOGLE_CLOUD_PROJECT}"
  GCP_LOCATION: "us-central1"
  VECTOR_PROCESSING_QUEUE: "vector-processing"
  VECTOR_PROCESSING_ENDPOINT: "https://vector-processor-dot-${GOOGLE_CLOUD_PROJECT}.uc.r.appspot.com/api/process"
  TASK_DISPATCH_DEADLINE: "600"
  TASK_SCHEDULE_DELAY: "0"

skip_files:
- ^venv$
- ^\.git$
- ^\.github$
- ^\.vscode$
- ^\.pytest_cache$
- ^\.mypy_cache$
- ^__pycache__$
- ^.*\.pyc$
- ^.*\.md$
- ^.*\.log$
- ^test_reports/$
- ^coverage_reports/$
- ^tests/$
- ^uploads/$
- ^backend-deploy\.zip$
- ^temp_deploy/$
