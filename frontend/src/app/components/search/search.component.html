<div class="search-container">
  <div class="search-header">
    <h1>Search Conference Content</h1>
    <p>Find presentations, documents, and resources using AI-powered search</p>
    
    <form [formGroup]="searchForm" (ngSubmit)="search()">
      <div class="search-bar">
        <mat-form-field appearance="outline" class="search-input">
          <mat-label>Search for content...</mat-label>
          <input matInput formControlName="query" placeholder="Enter keywords, topics, or questions">
          <button mat-icon-button matSuffix aria-label="Search" type="submit">
            <mat-icon>search</mat-icon>
          </button>
        </mat-form-field>
        
        <mat-checkbox formControlName="useAi" color="primary" class="ai-toggle">
          Use AI-powered search
        </mat-checkbox>
      </div>
    </form>
  </div>
  
  <div class="search-content">
    <div class="filters-panel">
      <h3>Filters</h3>
      
      <!-- Session Dates Filter -->
      <mat-expansion-panel class="filter-section">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Session Dates
          </mat-panel-title>
        </mat-expansion-panel-header>
        <mat-selection-list [multiple]="true">
          <mat-list-option *ngFor="let date of sessionDates" 
                         [selected]="selectedSessionDates.includes(date.id)"
                         (click)="toggleSessionDate(date.id)">
            {{ date.date }}
          </mat-list-option>
        </mat-selection-list>
      </mat-expansion-panel>
      
      <!-- Session Types Filter -->
      <mat-expansion-panel class="filter-section">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Session Types
          </mat-panel-title>
        </mat-expansion-panel-header>
        <mat-selection-list [multiple]="true" class="scrollable-list">
          <mat-list-option *ngFor="let type of sessionTypes" 
                         [selected]="selectedSessionTypes.includes(type.id)"
                         (click)="toggleSessionType(type.id)">
            {{ type.name }}
          </mat-list-option>
        </mat-selection-list>
      </mat-expansion-panel>
      
      <!-- Learning Level Filter -->
      <mat-expansion-panel class="filter-section">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Learning Level
          </mat-panel-title>
        </mat-expansion-panel-header>
        <mat-selection-list [multiple]="true">
          <mat-list-option *ngFor="let level of learningLevels" 
                         [selected]="selectedLearningLevels.includes(level.id)"
                         (click)="toggleLearningLevel(level.id)">
            {{ level.name }}
          </mat-list-option>
        </mat-selection-list>
      </mat-expansion-panel>
      
      <!-- Topic Filter -->
      <mat-expansion-panel class="filter-section">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Topic
          </mat-panel-title>
        </mat-expansion-panel-header>
        <mat-selection-list [multiple]="true" class="scrollable-list">
          <mat-list-option *ngFor="let topic of topics" 
                         [selected]="selectedTopics.includes(topic.id)"
                         (click)="toggleTopic(topic.id)">
            {{ topic.name }}
          </mat-list-option>
        </mat-selection-list>
      </mat-expansion-panel>
      
      <!-- Job Role Filter -->
      <mat-expansion-panel class="filter-section">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Job Role
          </mat-panel-title>
        </mat-expansion-panel-header>
        <mat-selection-list [multiple]="true" class="scrollable-list">
          <mat-list-option *ngFor="let role of jobRoles" 
                         [selected]="selectedJobRoles.includes(role.id)"
                         (click)="toggleJobRole(role.id)">
            {{ role.name }}
          </mat-list-option>
        </mat-selection-list>
      </mat-expansion-panel>
      
      <!-- Area of Interest Filter -->
      <mat-expansion-panel class="filter-section">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Area of Interest
          </mat-panel-title>
        </mat-expansion-panel-header>
        <mat-selection-list [multiple]="true" class="scrollable-list">
          <mat-list-option *ngFor="let area of areasOfInterest" 
                         [selected]="selectedAreasOfInterest.includes(area.id)"
                         (click)="toggleAreaOfInterest(area.id)">
            {{ area.name }}
          </mat-list-option>
        </mat-selection-list>
      </mat-expansion-panel>
      
      <!-- Industry Filter -->
      <mat-expansion-panel class="filter-section">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Industry
          </mat-panel-title>
        </mat-expansion-panel-header>
        <mat-selection-list [multiple]="true" class="scrollable-list">
          <mat-list-option *ngFor="let industry of industries" 
                         [selected]="selectedIndustries.includes(industry.id)"
                         (click)="toggleIndustry(industry.id)">
            {{ industry.name }}
          </mat-list-option>
        </mat-selection-list>
      </mat-expansion-panel>
      
      <!-- Popular Tags Filter -->
      <mat-expansion-panel class="filter-section">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Popular Tags
          </mat-panel-title>
        </mat-expansion-panel-header>
        <div class="tag-chips">
          <mat-chip-set>
            <mat-chip *ngFor="let tag of availableTags"
                    [selected]="selectedTags.includes(tag)"
                    (click)="toggleTag(tag)">
              {{ tag }}
            </mat-chip>
          </mat-chip-set>
        </div>
      </mat-expansion-panel>
      
      <button mat-raised-button color="primary" class="clear-filters-btn" (click)="clearFilters()" 
              [disabled]="!selectedTracks.length && !selectedTags.length && !selectedSessionDates.length && 
                         !selectedSessionTypes.length && !selectedLearningLevels.length && !selectedTopics.length && 
                         !selectedJobRoles.length && !selectedAreasOfInterest.length && !selectedIndustries.length">
        Clear Filters
      </button>
    </div>
    
    <div class="results-panel">
      <!-- AI Answer Section (when using RAG) -->
      <mat-card *ngIf="isAiSearch && ragResponse" class="ai-answer-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>smart_toy</mat-icon>
          <mat-card-title>AI Answer</mat-card-title>
          <mat-card-subtitle>
            Relevance: {{ ragResponse.relevanceScore | percent }} | 
            Grounding: {{ ragResponse.groundingScore | percent }}
          </mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <p>{{ ragResponse.answer }}</p>
        </mat-card-content>
      </mat-card>
      
      <!-- Loading Indicator -->
      <div *ngIf="loading" class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Searching content...</p>
      </div>
      
      <!-- Results Count -->
      <div *ngIf="!loading" class="results-count">
        <p *ngIf="searchForm.get('query')?.value">
          {{ totalResults }} results for "{{ searchForm.get('query')?.value }}"
        </p>
        <p *ngIf="!searchForm.get('query')?.value">
          Showing {{ totalResults }} recent items
        </p>
      </div>
      
      <!-- Results List -->
      <div class="results-list">
        <div class="session-card" *ngFor="let content of searchResults">
          <div class="session-card-header">
            <h3 class="session-title">{{ content.title }}</h3>
            <div class="session-meta">
              <span *ngIf="content.sessionType" class="session-type">{{ content.sessionType }}</span>
              <span *ngIf="content.track" class="session-track">{{ getTrackById(content.track)?.name }}</span>
              <span *ngIf="content.sessionDate" class="session-date">{{ content.sessionDate }}</span>
              <span *ngIf="content.learningLevel" class="learning-level">{{ content.learningLevel }}</span>
            </div>
          </div>
          
          <div class="session-card-content">
            <p class="session-description">{{ content.description }}</p>
            
            <!-- Tags -->
            <div class="content-tags">
              <span *ngFor="let tag of content.tags" class="tag-pill">{{ tag }}</span>
            </div>
            
            <!-- AI Summary if available -->
            <div *ngIf="content.aiSummary" class="ai-summary">
              <mat-expansion-panel>
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <mat-icon>auto_awesome</mat-icon>
                    AI Summary
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <p>{{ content.aiSummary }}</p>
              </mat-expansion-panel>
            </div>
          </div>
          
          <div class="session-card-actions">
            <button mat-button color="primary" [routerLink]="['/content', content.id]">
              View Details
            </button>
            <button mat-button (click)="findSimilarDocuments(content.id!)">
              Find Similar
            </button>
          </div>
        </div>
        
        <!-- No Results -->
        <div *ngIf="!loading && searchResults.length === 0" class="no-results">
          <mat-icon>search_off</mat-icon>
          <h3>No results found</h3>
          <p>Try adjusting your search terms or clearing filters</p>
        </div>
      </div>
      
      <!-- Pagination -->
      <mat-paginator *ngIf="totalResults > 0"
                    [length]="totalResults"
                    [pageSize]="pageSize"
                    [pageSizeOptions]="[5, 10, 25, 50]"
                    (page)="onPageChange($event)">
      </mat-paginator>
    </div>
  </div>
</div> 